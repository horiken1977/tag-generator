<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ·ï¸ Tag Generator - APIç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .form-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
        }
        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .btn:hover { background: #45a049; }
        .btn:disabled { background: #666; cursor: not-allowed; }
        .btn-secondary { background: #2196F3; }
        .btn-secondary:hover { background: #1976D2; }
        .btn-home { background: #FF9800; }
        .btn-home:hover { background: #F57C00; }
        .progress {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .status.success { background: rgba(76,175,80,0.3); }
        .status.info { background: rgba(33,150,243,0.3); }
        .status.warning { background: rgba(255,193,7,0.3); }
        .status.error { background: rgba(244,67,54,0.3); }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .hidden { display: none; }
        .result-section {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .api-mode {
            background: rgba(76,175,80,0.2);
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .column-mapping {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .column-mapping h4 {
            margin-bottom: 10px;
            color: #74c0fc;
        }
        .mapping-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ·ï¸ Tag Generator</h1>
            <p>ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ•™è‚²å‹•ç”»ã®AIã‚¿ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  - APIç‰ˆ</p>
            <button class="btn btn-home" onclick="window.location.href='index.html'">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        </div>
        
        <div class="api-mode">
            <h3>ğŸ”— APIé€£æºãƒ¢ãƒ¼ãƒ‰</h3>
            <p>å®Ÿéš›ã®Google Sheets APIã¨AIå‡¦ç†æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™</p>
            <div id="api-status">ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³ã‚’ç¢ºèªä¸­...</div>
        </div>
        
        <div class="card">
            <h2>ğŸ“Š Google Sheets è¨­å®š</h2>
            <div class="form-group">
                <label for="sheets-url">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL</label>
                <input type="url" id="sheets-url" placeholder="https://docs.google.com/spreadsheets/d/...">
                <small style="opacity: 0.8;">â€»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯å…¬é–‹è¨­å®šã«ã—ã¦ãã ã•ã„</small>
            </div>
            <button class="btn btn-secondary" onclick="testConnection()" id="test-btn">
                <span id="test-loading" class="loading hidden"></span>
                æ¥ç¶šãƒ†ã‚¹ãƒˆ
            </button>
            <button class="btn btn-secondary" onclick="runDiagnostics()" id="diagnostic-btn" style="margin-left: 10px;">
                <span id="diagnostic-loading" class="loading hidden"></span>
                è¨ºæ–­ãƒ†ã‚¹ãƒˆ
            </button>
            <button class="btn btn-secondary" onclick="testSimpleProcessing()" id="simple-test-btn" style="margin-left: 10px;">
                <span id="simple-test-loading" class="loading hidden"></span>
                ç°¡æ˜“å‡¦ç†ãƒ†ã‚¹ãƒˆ
            </button>
            
            <div id="connection-status"></div>
            
            <div id="column-mapping" class="column-mapping hidden">
                <h4>ğŸ“‹ åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š</h4>
                <p style="opacity: 0.8; margin-bottom: 15px;">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’ä¸‹è¨˜ã®é …ç›®ã«å‰²ã‚Šå½“ã¦ã¦ãã ã•ã„ã€‚å¿…é ˆé …ç›®ï¼šã‚¿ã‚¤ãƒˆãƒ«ã€ã‚¹ã‚­ãƒ«å</p>
                <div class="mapping-row">
                    <label><span style="color: #ff6b6b;">*</span> ã‚¿ã‚¤ãƒˆãƒ«åˆ—:</label>
                    <select id="title-column" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label><span style="color: #ff6b6b;">*</span> ã‚¹ã‚­ãƒ«ååˆ—:</label>
                    <select id="skill-column" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label>èª¬æ˜æ–‡åˆ—:</label>
                    <select id="description-column">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label>è¦ç´„åˆ—:</label>
                    <select id="summary-column">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label>æ–‡å­—èµ·ã“ã—åˆ—:</label>
                    <select id="transcript-column">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</option>
                    </select>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(74, 144, 226, 0.2); border-radius: 5px;">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®1è¡Œç›®ãŒãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯2è¡Œç›®ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
                </div>
            </div>
        </div>
        
        <div class="grid">
            <div class="card">
                <h2>ğŸ¤– AI ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ</h2>
                <div class="form-group">
                    <label for="ai-engine">å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³</label>
                    <select id="ai-engine">
                        <option value="openai">OpenAI GPT-4</option>
                        <option value="claude">Claude 3.5 Sonnet</option>
                        <option value="gemini">Google Gemini</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="max-tags">æœ€å¤§ã‚¿ã‚°æ•°</label>
                    <select id="max-tags">
                        <option value="150">150å€‹</option>
                        <option value="200" selected>200å€‹ (æ¨å¥¨)</option>
                        <option value="250">250å€‹</option>
                    </select>
                </div>
            </div>
            
            <div class="card">
                <h2>âš™ï¸ å‡¦ç†è¨­å®š</h2>
                <div class="form-group">
                    <label for="batch-size">ãƒãƒƒãƒã‚µã‚¤ã‚º</label>
                    <select id="batch-size">
                        <option value="10">10ä»¶</option>
                        <option value="20" selected>20ä»¶ (æ¨å¥¨)</option>
                        <option value="50">50ä»¶</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quality">å‡¦ç†å“è³ª</label>
                    <select id="quality">
                        <option value="fast">é«˜é€Ÿå‡¦ç†</option>
                        <option value="balanced" selected>ãƒãƒ©ãƒ³ã‚¹</option>
                        <option value="high">é«˜å“è³ª</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸš€ å‡¦ç†å®Ÿè¡Œ</h2>
            <button class="btn" onclick="startProcessing()" id="process-btn" disabled>
                <span id="process-loading" class="loading hidden"></span>
                ã‚¿ã‚°ç”Ÿæˆé–‹å§‹
            </button>
            <button class="btn btn-secondary" onclick="previewData()">ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
            
            <div id="processing-status" class="hidden">
                <div class="progress">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div id="status-text">å‡¦ç†ä¸­...</div>
            </div>
        </div>
        
        <div class="card result-section hidden" id="results">
            <h2>ğŸ“‹ å‡¦ç†çµæœ</h2>
            <div id="result-content"></div>
        </div>
    </div>
    
    <script>
        let isProcessing = false;
        let sheetData = null;
        let columnHeaders = [];
        
        // APIãƒ™ãƒ¼ã‚¹URLã®è¨­å®šï¼ˆPHP APIä½¿ç”¨ï¼‰
        const API_BASE_URL = window.location.protocol + '//' + window.location.hostname + window.location.pathname.replace(/\/[^\/]*$/, '') + '/api.php';
        
        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚¿ã‚°æˆ¦ç•¥ç”Ÿæˆ
        function generateClientSideTagStrategy(sampleData) {
            const skills = new Set();
            const keywords = new Set();
            
            sampleData.forEach(item => {
                // ã‚¹ã‚­ãƒ«åã‹ã‚‰åŸºæœ¬ã‚«ãƒ†ã‚´ãƒªã‚’æŠ½å‡º
                const skill = (item.skill || '').toLowerCase();
                if (skill.includes('ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°')) skills.add('ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°');
                if (skill.includes('ãƒ‡ãƒ¼ã‚¿')) skills.add('ãƒ‡ãƒ¼ã‚¿åˆ†æ');
                if (skill.includes('ai') || skill.includes('AI')) skills.add('AIæ´»ç”¨');
                if (skill.includes('ã‚­ãƒ£ãƒªã‚¢')) skills.add('ã‚­ãƒ£ãƒªã‚¢é–‹ç™º');
                if (skill.includes('æˆ¦ç•¥')) skills.add('ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥');
                if (skill.includes('å–¶æ¥­')) skills.add('ã‚»ãƒ¼ãƒ«ã‚¹');
                if (skill.includes('ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ')) skills.add('ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ');
                if (skill.includes('ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—')) skills.add('ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—');
                
                // ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
                const text = `${item.title || ''} ${item.description || ''}`.toLowerCase();
                if (text.includes('åŠ¹ç‡')) keywords.add('æ¥­å‹™åŠ¹ç‡');
                if (text.includes('æ”¹å–„')) keywords.add('æ¥­å‹™æ”¹å–„');
                if (text.includes('åˆ†æ')) keywords.add('ãƒ‡ãƒ¼ã‚¿åˆ†æ');
                if (text.includes('æˆ¦ç•¥')) keywords.add('æˆ¦ç•¥ç«‹æ¡ˆ');
                if (text.includes('é¡§å®¢')) keywords.add('é¡§å®¢ç†è§£');
                if (text.includes('ãƒãƒ¼ãƒ ')) keywords.add('ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯');
                if (text.includes('ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³')) keywords.add('ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³');
                if (text.includes('å•é¡Œè§£æ±º')) keywords.add('å•é¡Œè§£æ±º');
            });
            
            return {
                baseSkills: Array.from(skills),
                commonKeywords: Array.from(keywords),
                tagCount: 12 // 1ä»¶ã‚ãŸã‚Š10-15å€‹ã®ã‚¿ã‚°ï¼ˆå¹³å‡12å€‹ï¼‰
            };
        }
        
        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚¿ã‚°ç”Ÿæˆï¼ˆè©³ç´°ç‰ˆï¼‰
        function generateClientSideTags(item, strategy) {
            const tags = [];
            const text = `${item.title || ''} ${item.description || ''} ${item.summary || ''}`.toLowerCase();
            const skill = (item.skill || '').toLowerCase();
            
            // 1. è©³ç´°ã‚¹ã‚­ãƒ«åˆ†é¡
            if (skill.includes('ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°')) {
                tags.push('ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥');
                if (text.includes('ãƒ‡ã‚¸ã‚¿ãƒ«')) tags.push('ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°');
                if (text.includes('ãƒ–ãƒ©ãƒ³ãƒ‰')) tags.push('ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°');
                if (text.includes('sns') || text.includes('ã‚½ãƒ¼ã‚·ãƒ£ãƒ«')) tags.push('SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°');
            }
            if (skill.includes('ãƒ‡ãƒ¼ã‚¿')) {
                tags.push('ãƒ‡ãƒ¼ã‚¿åˆ†æ');
                if (text.includes('å¯è¦–åŒ–')) tags.push('ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–');
                if (text.includes('bi') || text.includes('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰')) tags.push('BIãƒ„ãƒ¼ãƒ«');
            }
            if (skill.includes('ai') || skill.includes('AI')) {
                tags.push('AIæ´»ç”¨');
                if (text.includes('æ©Ÿæ¢°å­¦ç¿’')) tags.push('æ©Ÿæ¢°å­¦ç¿’');
                if (text.includes('è‡ªå‹•åŒ–')) tags.push('æ¥­å‹™è‡ªå‹•åŒ–');
            }
            if (skill.includes('ã‚­ãƒ£ãƒªã‚¢')) {
                tags.push('ã‚­ãƒ£ãƒªã‚¢é–‹ç™º');
                if (text.includes('è»¢è·')) tags.push('è»¢è·æˆ¦ç•¥');
                if (text.includes('ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—')) tags.push('ã‚¹ã‚­ãƒ«å‘ä¸Š');
            }
            if (skill.includes('å–¶æ¥­')) {
                tags.push('å–¶æ¥­æˆ¦ç•¥');
                if (text.includes('ææ¡ˆ')) tags.push('ææ¡ˆåŠ›');
                if (text.includes('äº¤æ¸‰')) tags.push('äº¤æ¸‰è¡“');
            }
            if (skill.includes('ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ')) {
                tags.push('ãƒãƒ¼ãƒ ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ');
                if (text.includes('éƒ¨ä¸‹')) tags.push('éƒ¨ä¸‹è‚²æˆ');
                if (text.includes('è©•ä¾¡')) tags.push('äººäº‹è©•ä¾¡');
            }
            
            // 2. ã‚¿ã‚¤ãƒˆãƒ«ãƒ»å†…å®¹ã‹ã‚‰ã®è©³ç´°æŠ½å‡º
            if (text.includes('ã‚¹ãƒ†ãƒ¼ã‚¸') || text.includes('æ®µéš')) tags.push('æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ');
            if (text.includes('æµæ´¾') || text.includes('ç¨®é¡')) tags.push('åˆ†é¡ä½“ç³»');
            if (text.includes('å®Œå…¨æ”»ç•¥') || text.includes('å¾¹åº•è§£èª¬')) tags.push('åŒ…æ‹¬çš„è§£èª¬');
            if (text.includes('ã‚¹ãƒ”ãƒ¼ãƒ‰') || text.includes('é€Ÿåº¦')) tags.push('æ¥­å‹™ã‚¹ãƒ”ãƒ¼ãƒ‰');
            if (text.includes('æ–½ç­–') || text.includes('å–ã‚Šçµ„ã¿')) tags.push('å…·ä½“çš„æ–½ç­–');
            if (text.includes('æ”¹å–„') || text.includes('æœ€é©åŒ–')) tags.push('ãƒ—ãƒ­ã‚»ã‚¹æ”¹å–„');
            if (text.includes('åŠ¹ç‡') || text.includes('ç”Ÿç”£æ€§')) tags.push('åŠ¹ç‡åŒ–æ‰‹æ³•');
            if (text.includes('é¡§å®¢ç†è§£') || text.includes('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç†è§£')) tags.push('é¡§å®¢ã‚¤ãƒ³ã‚µã‚¤ãƒˆ');
            if (text.includes('ã‚³ãƒ„') || text.includes('ãƒã‚¤ãƒ³ãƒˆ')) tags.push('å®Ÿè·µçš„ãƒã‚¦ãƒã‚¦');
            if (text.includes('å°‚é–€å®¶') || text.includes('ãƒ—ãƒ­')) tags.push('å°‚é–€çŸ¥è­˜');
            if (text.includes('åŸºç¤') || text.includes('åŸºæœ¬')) tags.push('åŸºç¤çŸ¥è­˜');
            if (text.includes('å¿œç”¨') || text.includes('å®Ÿè·µ')) tags.push('å®Ÿè·µçš„æ´»ç”¨');
            if (text.includes('äº‹ä¾‹') || text.includes('å…·ä½“ä¾‹')) tags.push('äº‹ä¾‹ç ”ç©¶');
            if (text.includes('ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯') || text.includes('æ‰‹æ³•')) tags.push('åˆ†ææ‰‹æ³•');
            if (text.includes('æˆ¦ç•¥') || text.includes('è¨ˆç”»')) tags.push('æˆ¦ç•¥çš„æ€è€ƒ');
            if (text.includes('çµ„ç¹”') || text.includes('ä¼šç¤¾')) tags.push('çµ„ç¹”é‹å–¶');
            if (text.includes('æˆé•·') || text.includes('ç™ºå±•')) tags.push('æˆé•·æˆ¦ç•¥');
            if (text.includes('èª²é¡Œ') || text.includes('å•é¡Œ')) tags.push('èª²é¡Œè§£æ±º');
            if (text.includes('ç›®æ¨™') || text.includes('ã‚´ãƒ¼ãƒ«')) tags.push('ç›®æ¨™è¨­å®š');
            if (text.includes('è©•ä¾¡') || text.includes('æ¸¬å®š')) tags.push('æˆæœæ¸¬å®š');
            if (text.includes('å¤‰åŒ–') || text.includes('å¤‰é©')) tags.push('å¤‰é©ç®¡ç†');
            if (text.includes('ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³') || text.includes('å¯¾è©±')) tags.push('å¯¾è©±è¡“');
            if (text.includes('ãƒ—ãƒ¬ã‚¼ãƒ³') || text.includes('ç™ºè¡¨')) tags.push('ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ã‚­ãƒ«');
            if (text.includes('ä¼ç”»') || text.includes('ç«‹æ¡ˆ')) tags.push('ä¼ç”»åŠ›');
            if (text.includes('èª¿æŸ»') || text.includes('ç ”ç©¶')) tags.push('èª¿æŸ»æ‰‹æ³•');
            if (text.includes('å ±å‘Š') || text.includes('ãƒ¬ãƒãƒ¼ãƒˆ')) tags.push('ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ');
            
            // 3. æ•°å€¤ãƒ»æ™‚é–“é–¢é€£
            if (text.includes('6') || text.includes('å…­')) tags.push('6ã¤ã®è¦ç´ ');
            if (text.includes('8') || text.includes('å…«')) tags.push('8ã¤ã®åˆ†é¡');
            if (text.includes('4') || text.includes('å››')) tags.push('4ã¤ã®ãƒã‚¤ãƒ³ãƒˆ');
            if (text.includes('10') || text.includes('å')) tags.push('10ã®è¦ç´ ');
            
            // 4. æ¥­ç•Œãƒ»åˆ†é‡ç‰¹æœ‰
            if (text.includes('äº‹æ¥­ä¼šç¤¾') || text.includes('ã‚¤ãƒ³ãƒã‚¦ã‚¹')) tags.push('äº‹æ¥­ä¼šç¤¾è¦–ç‚¹');
            if (text.includes('æ”¯æ´ä¼šç¤¾') || text.includes('ã‚³ãƒ³ã‚µãƒ«')) tags.push('æ”¯æ´ä¼šç¤¾è¦–ç‚¹');
            if (text.includes('ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—') || text.includes('ãƒ™ãƒ³ãƒãƒ£ãƒ¼')) tags.push('ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—');
            if (text.includes('å¤§ä¼æ¥­') || text.includes('å¤§æ‰‹')) tags.push('å¤§ä¼æ¥­');
            if (text.includes('ä¸­å°ä¼æ¥­') || text.includes('SME')) tags.push('ä¸­å°ä¼æ¥­');
            
            // 5. ãƒ¬ãƒ™ãƒ«ãƒ»å¯¾è±¡è€…
            if (text.includes('åˆå¿ƒè€…') || text.includes('å…¥é–€')) tags.push('åˆå¿ƒè€…å‘ã‘');
            if (text.includes('ä¸­ç´š') || text.includes('ãƒŸãƒ‰ãƒ«')) tags.push('ä¸­ç´šè€…å‘ã‘');
            if (text.includes('ä¸Šç´š') || text.includes('ã‚¢ãƒ‰ãƒãƒ³ã‚¹')) tags.push('ä¸Šç´šè€…å‘ã‘');
            if (text.includes('ç®¡ç†è·') || text.includes('ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼')) tags.push('ç®¡ç†è·å‘ã‘');
            if (text.includes('æ–°äºº') || text.includes('è‹¥æ‰‹')) tags.push('è‹¥æ‰‹ç¤¾å“¡å‘ã‘');
            
            // 6. è¿½åŠ ã®å…·ä½“çš„ã‚¹ã‚­ãƒ«
            if (tags.length < 10) {
                const additionalTags = [
                    'å®Ÿå‹™ã‚¹ã‚­ãƒ«', 'æ€è€ƒæ³•', 'æ¥­ç•ŒçŸ¥è­˜', 'ãƒ„ãƒ¼ãƒ«æ´»ç”¨',
                    'äººæè‚²æˆ', 'ã‚¹ã‚­ãƒ«é–‹ç™º', 'æˆæœå‘ä¸Š', 'åŠ¹ç‡åŒ–',
                    'æˆ¦è¡“', 'æ‰‹é †', 'æ–¹æ³•è«–', 'çŸ¥è­˜ä½“ç³»'
                ];
                additionalTags.forEach(tag => {
                    if (tags.length < 15 && !tags.includes(tag)) {
                        tags.push(tag);
                    }
                });
            }
            
            // é‡è¤‡é™¤å»ã—ã¦10-15å€‹ã®ç¯„å›²ã§è¿”ã™
            const uniqueTags = [...new Set(tags)];
            const finalCount = Math.max(10, Math.min(15, uniqueTags.length));
            return uniqueTags.slice(0, finalCount);
        }
        
        // APIå‘¼ã³å‡ºã—ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        async function callAPI(action, options = {}) {
            try {
                const url = API_BASE_URL + '?action=' + action;
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        'Accept': 'application/json, text/plain, */*',
                        'Accept-Language': 'ja-JP,ja;q=0.9,en;q=0.8',
                        'Cache-Control': 'no-cache',
                        ...options.headers
                    }
                });
                
                if (!response.ok) {
                    const responseText = await response.text();
                    console.error('HTTP Error Response:', response.status, responseText);
                    throw new Error(`HTTP error! status: ${response.status}, response: ${responseText.substring(0, 200)}`);
                }
                
                const responseText = await response.text();
                console.log('Raw API Response:', responseText.substring(0, 500));
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError);
                    console.error('Response text:', responseText);
                    throw new Error(`Failed to parse JSON response: ${parseError.message}`);
                }
                
                return data;
            } catch (error) {
                console.error('API call error:', error);
                throw error;
            }
        }
        
        // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³ç¢ºèª
        async function checkApiStatus() {
            try {
                const data = await callAPI('status');
                
                if (data.status === 'running') {
                    document.getElementById('api-status').innerHTML = 
                        `âœ… APIã‚µãƒ¼ãƒãƒ¼ç¨¼åƒä¸­ (v${data.version})`;
                    return true;
                }
            } catch (error) {
                document.getElementById('api-status').innerHTML = 
                    `âŒ APIã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ (${error.message})`;
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
                console.error('API Status Check Failed:', error);
                console.log('Attempted URL:', API_BASE_URL + '?action=status');
                
                return false;
            }
        }
        
        // è¨ºæ–­ãƒ†ã‚¹ãƒˆ
        async function runDiagnostics() {
            const diagnosticBtn = document.getElementById('diagnostic-btn');
            const diagnosticLoading = document.getElementById('diagnostic-loading');
            const statusDiv = document.getElementById('connection-status');
            
            console.log('Starting diagnostics...');
            
            // UIæ›´æ–°
            diagnosticBtn.disabled = true;
            diagnosticLoading.classList.remove('hidden');
            statusDiv.innerHTML = '<div class="status info">ğŸ” ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­ä¸­...</div>';
            
            try {
                console.log('Calling debug_test endpoint...');
                const result = await callAPI('debug_test', {
                    method: 'POST',
                    body: JSON.stringify({})
                });
                
                console.log('Diagnostic result:', result);
                
                // çµæœã‚’è¡¨ç¤º
                statusDiv.innerHTML = `
                    <div class="status ${result.completed ? 'success' : 'warning'}">
                        <h4>ğŸ” ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­çµæœ</h4>
                        <div style="text-align: left; margin: 15px 0;">
                            <strong>åŸºæœ¬è¨­å®š:</strong><br>
                            â€¢ ãƒ¡ãƒ¢ãƒªåˆ¶é™: ${result.memory_limit || 'N/A'}<br>
                            â€¢ å®Ÿè¡Œæ™‚é–“åˆ¶é™: ${result.max_execution_time || 'N/A'}ç§’<br>
                            â€¢ ç¾åœ¨ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${result.current_memory || 'N/A'}<br>
                            â€¢ cURLåˆ©ç”¨å¯èƒ½: ${result.curl_available ? 'âœ…' : 'âŒ'}<br>
                            â€¢ .envãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨: ${result.env_file_exists ? 'âœ…' : 'âŒ'}<br>
                            <br>
                            <strong>ç’°å¢ƒå¤‰æ•°:</strong><br>
                            â€¢ èª­ã¿è¾¼ã¿æ¸ˆã¿å¤‰æ•°æ•°: ${result.env_vars_count || 0}å€‹<br>
                            â€¢ APIã‚­ãƒ¼åˆ©ç”¨å¯èƒ½: ${result.api_key_available ? 'âœ…' : 'âŒ'}<br>
                            <br>
                            <strong>å‡¦ç†ãƒ†ã‚¹ãƒˆ:</strong><br>
                            â€¢ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚°: ${result.simulation_tags ? result.simulation_tags.length + 'å€‹ç”Ÿæˆ' : 'âŒ å¤±æ•—'}<br>
                            â€¢ æœ€çµ‚ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${result.final_memory || 'N/A'}<br>
                            â€¢ å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—: ${result.step || 'ä¸æ˜'}<br>
                            â€¢ è¨ºæ–­å®Œäº†: ${result.completed ? 'âœ…' : 'âŒ'}
                        </div>
                        ${result.env_error ? `<div style="color: #ff6b6b;">ç’°å¢ƒã‚¨ãƒ©ãƒ¼: ${result.env_error}</div>` : ''}
                        ${result.api_key_error ? `<div style="color: #ff6b6b;">APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼: ${result.api_key_error}</div>` : ''}
                        ${result.simulation_error ? `<div style="color: #ff6b6b;">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ${result.simulation_error}</div>` : ''}
                    </div>
                `;
                
            } catch (error) {
                console.error('Diagnostic failed:', error);
                statusDiv.innerHTML = `
                    <div class="status error">
                        âŒ è¨ºæ–­ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}<br>
                        <small>è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„</small>
                    </div>
                `;
            } finally {
                diagnosticBtn.disabled = false;
                diagnosticLoading.classList.add('hidden');
            }
        }
        
        // ç°¡æ˜“å‡¦ç†ãƒ†ã‚¹ãƒˆ
        async function testSimpleProcessing() {
            const simpleTestBtn = document.getElementById('simple-test-btn');
            const simpleTestLoading = document.getElementById('simple-test-loading');
            const statusDiv = document.getElementById('connection-status');
            
            console.log('Starting simple processing test...');
            
            // UIæ›´æ–°
            simpleTestBtn.disabled = true;
            simpleTestLoading.classList.remove('hidden');
            statusDiv.innerHTML = '<div class="status info">ğŸ”„ ç°¡æ˜“å‡¦ç†ãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                // æœ€å°é™ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ ai_process ã‚’ãƒ†ã‚¹ãƒˆ
                const testData = {
                    data: [
                        {
                            title: "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ",
                            skill: "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
                            description: "ãƒ†ã‚¹ãƒˆèª¬æ˜æ–‡"
                        }
                    ],
                    ai_engine: "openai",
                    processing_mode: "lightweight",
                    batch_size: 1,
                    quality: "fast",
                    use_real_ai: false
                };
                
                console.log('Calling ai_process with test data:', testData);
                
                const result = await callAPI('ai_process', {
                    method: 'POST',
                    body: JSON.stringify(testData)
                });
                
                console.log('Simple processing result:', result);
                
                // çµæœã‚’è¡¨ç¤º
                statusDiv.innerHTML = `
                    <div class="status ${result.success ? 'success' : 'error'}">
                        <h4>ğŸ”„ ç°¡æ˜“å‡¦ç†ãƒ†ã‚¹ãƒˆçµæœ</h4>
                        <div style="text-align: left; margin: 15px 0;">
                            <strong>å‡¦ç†çµæœ:</strong><br>
                            â€¢ æˆåŠŸ: ${result.success ? 'âœ…' : 'âŒ'}<br>
                            â€¢ å‡¦ç†ä»¶æ•°: ${result.processed_count || 0}ä»¶<br>
                            â€¢ ç”Ÿæˆã‚¿ã‚°æ•°: ${result.total_tags_generated || 0}å€‹<br>
                            â€¢ å‡¦ç†æ™‚é–“: ${result.processing_time ? (result.processing_time * 1000).toFixed(2) + 'ms' : 'N/A'}<br>
                            â€¢ AIãƒ¢ãƒ¼ãƒ‰: ${result.ai_mode || 'N/A'}<br>
                            â€¢ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚º: ${result.request_size || 0}ãƒã‚¤ãƒˆ<br>
                            <br>
                            <strong>ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚°:</strong><br>
                            ${result.results && result.results.length > 0 ? 
                                result.results.map(r => 
                                    `â€¢ ${r.title}: [${r.generated_tags ? r.generated_tags.join(', ') : 'ãªã—'}]`
                                ).join('<br>') 
                                : 'âŒ çµæœãªã—'}
                        </div>
                        ${!result.success && result.error ? `<div style="color: #ff6b6b;">ã‚¨ãƒ©ãƒ¼: ${result.error}</div>` : ''}
                    </div>
                `;
                
            } catch (error) {
                console.error('Simple processing test failed:', error);
                statusDiv.innerHTML = `
                    <div class="status error">
                        âŒ ç°¡æ˜“å‡¦ç†ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}<br>
                        <small>è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„</small>
                    </div>
                `;
            } finally {
                simpleTestBtn.disabled = false;
                simpleTestLoading.classList.add('hidden');
            }
        }
        
        async function testConnection() {
            const url = document.getElementById('sheets-url').value;
            const statusDiv = document.getElementById('connection-status');
            const testBtn = document.getElementById('test-btn');
            const loading = document.getElementById('test-loading');
            
            if (!url) {
                statusDiv.innerHTML = '<div class="status warning">URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            // Show loading
            testBtn.disabled = true;
            loading.classList.remove('hidden');
            statusDiv.innerHTML = '<div class="status info">æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                const data = await callAPI('sheets_test', {
                    method: 'POST',
                    body: JSON.stringify({url: url})
                });
                
                if (data.success) {
                    columnHeaders = data.columns || [];
                    
                    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
                    const debugInfo = data.debug_info ? `
                        <details style="margin-top: 10px; opacity: 0.8;">
                            <summary>ãƒ‡ãƒãƒƒã‚°æƒ…å ±</summary>
                            <div style="font-size: 12px; background: rgba(0,0,0,0.1); padding: 5px; border-radius: 3px; margin-top: 5px;">
                                ç”Ÿãƒ‡ãƒ¼ã‚¿: ${data.debug_info.raw_header_line}<br>
                                ç·è¡Œæ•°: ${data.debug_info.total_lines}<br>
                                CSVã‚µã‚¤ã‚º: ${data.debug_info.csv_size}ãƒã‚¤ãƒˆ<br>
                                æ¤œå‡ºã•ã‚ŒãŸåˆ—æ•°: ${columnHeaders.length}
                            </div>
                        </details>
                    ` : '';
                    
                    statusDiv.innerHTML = `
                        <div class="status success">
                            âœ… æ¥ç¶šæˆåŠŸ<br>
                            ã‚·ãƒ¼ãƒˆID: ${data.sheet_id}<br>
                            ãƒ‡ãƒ¼ã‚¿è¡Œæ•°: ${data.rows}è¡Œ<br>
                            æ¤œå‡ºã•ã‚ŒãŸåˆ—æ•°: ${columnHeaders.length}å€‹<br>
                            åˆ—å: ${columnHeaders.join(', ')}<br>
                            ${debugInfo}
                        </div>
                    `;
                    
                    // åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šã‚’è¡¨ç¤º
                    if (columnHeaders.length > 0) {
                        setupColumnMapping(columnHeaders);
                        // åˆ—é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                        document.getElementById('column-mapping').classList.remove('hidden');
                        document.getElementById('process-btn').disabled = false;
                    } else {
                        statusDiv.innerHTML += `<div class="status warning">âš ï¸ åˆ—ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>`;
                    }
                } else {
                    statusDiv.innerHTML = `<div class="status error">âŒ ${data.error}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            } finally {
                testBtn.disabled = false;
                loading.classList.add('hidden');
            }
        }
        
        function setupColumnMapping(columns) {
            const mappingDiv = document.getElementById('column-mapping');
            mappingDiv.classList.remove('hidden');
            
            // å„ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«åˆ—åã‚’è¨­å®š
            const selects = [
                {id: 'title-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„', keywords: ['ã‚¿ã‚¤ãƒˆãƒ«', 'title', 'é¡Œå', 'ãƒ†ãƒ¼ãƒ']},
                {id: 'skill-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„', keywords: ['ã‚¹ã‚­ãƒ«', 'skill', 'ã‚«ãƒ†ã‚´ãƒª', 'category']},
                {id: 'description-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰', keywords: ['èª¬æ˜', 'description', 'æ¦‚è¦', 'summary']},
                {id: 'summary-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰', keywords: ['è¦ç´„', 'summary', 'ã¾ã¨ã‚', 'æ¦‚è¦']},
                {id: 'transcript-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰', keywords: ['æ–‡å­—èµ·ã“ã—', 'transcript', 'å†…å®¹', 'content', 'æœ¬æ–‡']}
            ];
            
            selects.forEach(selectConfig => {
                const select = document.getElementById(selectConfig.id);
                select.innerHTML = `<option value="">${selectConfig.placeholder}</option>`;
                
                // å¤‰æ›´æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
                select.addEventListener('change', updateValidationStatus);
                
                columns.forEach((col, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${col} (åˆ—${String.fromCharCode(65 + index)})`;
                    
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã®æ¨æ¸¬ï¼ˆã‚ˆã‚Šè©³ç´°ã«ï¼‰
                    const colLower = col.toLowerCase();
                    const isMatch = selectConfig.keywords.some(keyword => 
                        colLower.includes(keyword.toLowerCase()) || 
                        col.includes(keyword)
                    );
                    
                    if (isMatch && !select.value) {
                        option.selected = true;
                    }
                    
                    select.appendChild(option);
                });
            });
            
            // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
            updateValidationStatus();
        }
        
        function updateValidationStatus() {
            const titleSelected = document.getElementById('title-column').value;
            const skillSelected = document.getElementById('skill-column').value;
            const processBtn = document.getElementById('process-btn');
            
            if (titleSelected && skillSelected) {
                processBtn.disabled = false;
                processBtn.textContent = 'ã‚¿ã‚°ç”Ÿæˆé–‹å§‹';
            } else {
                processBtn.disabled = true;
                processBtn.textContent = 'å¿…é ˆé …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„';
            }
        }
        
        
        async function startProcessing() {
            if (isProcessing) return;
            
            const url = document.getElementById('sheets-url').value;
            if (!url) {
                alert('Google Sheetsã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèª
            const columnMapping = {
                title: document.getElementById('title-column').value,
                skill: document.getElementById('skill-column').value,
                description: document.getElementById('description-column').value,
                summary: document.getElementById('summary-column').value,
                transcript: document.getElementById('transcript-column').value
            };
            
            if (!columnMapping.title || !columnMapping.skill) {
                alert('å°‘ãªãã¨ã‚‚ã‚¿ã‚¤ãƒˆãƒ«åˆ—ã¨ã‚¹ã‚­ãƒ«åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            isProcessing = true;
            
            // DOMè¦ç´ ã‚’å®‰å…¨ã«å–å¾—
            const statusDiv = document.getElementById('processing-status');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');
            const resultsDiv = document.getElementById('results');
            const processBtn = document.getElementById('process-btn');
            const loading = document.getElementById('process-loading');
            
            // è¦ç´ ã®å­˜åœ¨ç¢ºèª
            if (!statusDiv || !progressBar || !statusText || !resultsDiv || !processBtn) {
                alert('UIè¦ç´ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                isProcessing = false;
                return;
            }
            
            // UIçŠ¶æ…‹ã‚’æ›´æ–°
            processBtn.disabled = true;
            processBtn.innerHTML = `
                <span class="loading"></span>
                æ®µéšçš„å‡¦ç†ä¸­...
            `;
            
            if (loading) {
                loading.classList.remove('hidden');
            }
            
            statusDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            
            try {
                // Stage 1: Get data from sheets
                statusText.innerHTML = `
                    <div class="status info">
                        ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—1/6: Google Sheetsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...<br>
                        <small>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«æ¥ç¶šã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã¾ã™</small>
                    </div>
                `;
                progressBar.style.width = '8%';
                
                const sheetsResponse = await callAPI('sheets_data', {
                    method: 'POST',
                    body: JSON.stringify({
                        url: url,
                        column_mapping: columnMapping
                    })
                });
                
                const sheetsData = sheetsResponse;
                
                // Stage 2: Client-side tag strategy (WAFå›é¿ã®ãŸã‚å®Œå…¨ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†)
                statusText.innerHTML = `
                    <div class="status info">
                        ğŸ” ã‚¹ãƒ†ãƒƒãƒ—2/6: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰äº‹å‰åˆ†æä¸­...<br>
                        <small>WAFå›é¿ã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¿ã‚°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ±ºå®š</small>
                    </div>
                `;
                progressBar.style.width = '16%';
                
                // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã‚¿ã‚°æˆ¦ç•¥ã‚’æ±ºå®š
                const tagStrategy = generateClientSideTagStrategy(sheetsData.data.slice(0, 20));
                
                // 1ç§’å¾…æ©Ÿï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å‡¦ç†æ„Ÿã‚’ä¸ãˆã‚‹ï¼‰
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Stage 3: Client-side tag generation (å®Œå…¨WAFå›é¿)
                statusText.innerHTML = `
                    <div class="status info">
                        ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—3/6: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚¿ã‚°ç”Ÿæˆä¸­...<br>
                        <small>WAFå®Œå…¨å›é¿ã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ï¼ˆãŠè©¦ã—10ä»¶ï¼‰</small>
                    </div>
                `;
                progressBar.style.width = '40%';
                
                // å®Œå…¨ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§å‡¦ç†
                const maxTotalItems = Math.min(sheetsData.data.length, 10);
                const allLightweightResults = [];
                
                for (let i = 0; i < maxTotalItems; i++) {
                    const item = sheetsData.data[i];
                    
                    statusText.innerHTML = `
                        <div class="status info">
                            ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—3/6: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚¿ã‚°ç”Ÿæˆä¸­...<br>
                            <small>ã‚¢ã‚¤ãƒ†ãƒ  ${i + 1}/${maxTotalItems} ã‚’å‡¦ç†ä¸­ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ï¼‰</small>
                        </div>
                    `;
                    
                    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã‚¿ã‚°ç”Ÿæˆ
                    const generatedTags = generateClientSideTags(item, tagStrategy);
                    
                    allLightweightResults.push({
                        title: item.title,
                        skill: item.skill,
                        generated_tags: generatedTags,
                        confidence: 0.8,
                        processing_type: 'client_side'
                    });
                    
                    // è¦–è¦šçš„ãªé€²æ—ã®ãŸã‚500mså¾…æ©Ÿ
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // çµæœã‚’ã¾ã¨ã‚ã‚‹
                const lightweightData = {
                    success: true,
                    results: allLightweightResults,
                    processed_count: allLightweightResults.length,
                    total_tags_generated: allLightweightResults.reduce((sum, result) => sum + (result.generated_tags?.length || 0), 0),
                    processing_time: maxTotalItems * 0.5, // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“
                    ai_mode: 'client_side', // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰
                    processing_mode: 'local_rules'
                };
                
                // Stage 4: Basic tag analysis (ç°¡å˜ãªçµ±åˆå‡¦ç†ã®ã¿)
                statusText.innerHTML = `
                    <div class="status info">
                        ğŸ¯ ã‚¹ãƒ†ãƒƒãƒ—4/6: ã‚¿ã‚°çµ±åˆåˆ†æä¸­...<br>
                        <small>ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚°ã®åŸºæœ¬çµ±åˆã¨é »åº¦åˆ†æ</small>
                    </div>
                `;
                progressBar.style.width = '80%';
                
                // è»½é‡ãªçµ±åˆå‡¦ç†ã®ã¿å®Ÿè¡Œï¼ˆè©³ç´°å‡¦ç†ã¨APIå‘¼ã³å‡ºã—ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰
                const allTags = lightweightData.results.flatMap(result => result.generated_tags || []);
                const tagFrequency = {};
                allTags.forEach(tag => {
                    tagFrequency[tag] = (tagFrequency[tag] || 0) + 1;
                });
                
                const unifiedData = {
                    success: true,
                    results: [{
                        unified_tags: Object.keys(tagFrequency).sort((a, b) => tagFrequency[b] - tagFrequency[a]),
                        tag_frequencies: tagFrequency,
                        original_count: allTags.length,
                        unified_count: Object.keys(tagFrequency).length
                    }],
                    processing_mode: 'simple_unified'
                };
                
                // Complete
                statusText.innerHTML = `
                    <div class="status success">
                        ğŸ‰ WAFå¯¾ç­–å‡¦ç†å®Œäº†ï¼<br>
                        <small>äº‹å‰åˆ†æâ†’1ä»¶ãšã¤å‡¦ç†â†’çµ±åˆã®6ã‚¹ãƒ†ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ</small>
                    </div>
                `;
                progressBar.style.width = '100%';
                
                // Show results
                setTimeout(() => {
                    displaySimpleResults(sheetsData, tagStrategy, lightweightData, unifiedData);
                    statusDiv.classList.add('hidden');
                    resultsDiv.classList.remove('hidden');
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    processBtn.disabled = false;
                    processBtn.innerHTML = `
                        <span id="process-loading" class="loading hidden"></span>
                        ã‚¿ã‚°ç”Ÿæˆé–‹å§‹
                    `;
                }, 1000);
                
            } catch (error) {
                console.error('Processing error:', error);
                
                let errorMessage = error.message;
                let helpText = 'è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                
                if (error.message.includes('HTTP error! status: 403')) {
                    errorMessage = 'ã‚µãƒ¼ãƒãƒ¼ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‹’å¦ã—ã¾ã—ãŸ';
                    helpText = 'ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã‚Šå°‘ãªã„ãƒ‡ãƒ¼ã‚¿ã§å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
                } else if (error.message.includes('HTTP error! status: 413')) {
                    errorMessage = 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚ºãŒåˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™';
                    helpText = 'ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã—ã¦å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
                } else if (error.message.includes('HTTP error! status: 504')) {
                    errorMessage = 'å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ';
                    helpText = 'ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã™ãã¾ã™ã€‚ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
                }
                
                statusText.innerHTML = `
                    <div class="status error">
                        âŒ ${errorMessage}<br>
                        <small>${helpText}</small><br>
                        <small style="margin-top: 10px; display: block;">
                            <strong>å¯¾å‡¦æ–¹æ³•:</strong><br>
                            1. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦å†è©¦è¡Œ<br>
                            2. ã‚ˆã‚Šå°ã•ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§è©¦è¡Œ<br>
                            3. å‡¦ç†å“è³ªã‚’ã€Œé«˜é€Ÿå‡¦ç†ã€ã«å¤‰æ›´
                        </small>
                    </div>
                `;
                progressBar.style.width = '0%';
                
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 10000);
            } finally {
                isProcessing = false;
                processBtn.disabled = false;
                processBtn.innerHTML = `
                    <span id="process-loading" class="loading hidden"></span>
                    ã‚¿ã‚°ç”Ÿæˆé–‹å§‹
                `;
                
                if (loading) {
                    loading.classList.add('hidden');
                }
            }
        }
        
        function displaySimpleResults(sheetsData, tagStrategy, lightweightData, unifiedData) {
            const aiEngine = document.getElementById('ai-engine').selectedOptions[0].text;
            const maxTags = document.getElementById('max-tags').value;
            
            // çµæœãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
            window.resultsData = {
                sheetsData: sheetsData,
                tagStrategy: tagStrategy,
                lightweightData: lightweightData,
                unifiedData: unifiedData
            };
            
            const unifiedResult = unifiedData.results[0];
            
            document.getElementById('result-content').innerHTML = `
                <div class="status success">
                    <h3>ğŸ‰ è©³ç´°ã‚¿ã‚°ç”Ÿæˆå®Œäº†</h3>
                    <p>â€¢ å‡¦ç†å‹•ç”»æ•°: ${lightweightData.processed_count}ä»¶ï¼ˆãŠè©¦ã—ç‰ˆï¼‰</p>
                    <p>â€¢ ã‚¿ã‚°ç”Ÿæˆæ•°: 1ä»¶ã‚ãŸã‚Š10-15å€‹ã®è©³ç´°ã‚¿ã‚°</p>
                    <p>â€¢ é‡è¤‡å¯¾ç­–: å…·ä½“çš„ã§å›ºæœ‰æ€§ã®é«˜ã„ã‚¿ã‚°ç”Ÿæˆ</p>
                    <p>â€¢ çµ±åˆå‡¦ç†: ${unifiedResult.original_count}å€‹ â†’ ${unifiedResult.unified_count}å€‹ã«æœ€é©åŒ–</p>
                    <p>â€¢ å‡¦ç†æ–¹å¼: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰è©³ç´°ãƒ«ãƒ¼ãƒ«ï¼ˆWAFå®Œå…¨å›é¿ï¼‰</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: rgba(76,175,80,0.2); padding: 15px; border-radius: 8px;">
                        <h5>ğŸ” è©³ç´°ã‚¿ã‚°ç”Ÿæˆçµæœ</h5>
                        <p>1ä»¶ã‚ãŸã‚Š10-15å€‹ã®å…·ä½“çš„ã‚¿ã‚°</p>
                        <p>ã‚¹ã‚­ãƒ«ãƒ»å†…å®¹ãƒ»ãƒ¬ãƒ™ãƒ«åˆ¥ã®è©³ç´°åˆ†é¡</p>
                    </div>
                    <div style="background: rgba(156,39,176,0.2); padding: 15px; border-radius: 8px;">
                        <h5>ğŸ”§ é‡è¤‡é™¤å»ãƒ»çµ±åˆæœ€é©åŒ–</h5>
                        <p>é¡ä¼¼ã‚¿ã‚°çµ±åˆ: ${unifiedResult.original_count - unifiedResult.unified_count}å€‹å‰Šæ¸›</p>
                        <p>æœ€çµ‚ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¿ã‚°æ•°: ${unifiedResult.unified_count}å€‹</p>
                    </div>
                </div>
                
                <h4>ğŸ† æœ€çµ‚çµ±åˆã‚¿ã‚°ï¼ˆä¸Šä½20å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${unifiedResult.unified_tags.slice(0, 20).join(', ')}
                </div>
                
                <h4>ğŸ“Š ã‚¿ã‚°å‡ºç¾é »åº¦ï¼ˆä¸Šä½10å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${Object.entries(unifiedResult.tag_frequencies).slice(0, 10).map(([tag, freq]) => `
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>${tag}</span>
                            <span>${freq}å›</span>
                        </div>
                    `).join('')}
                </div>
                
                <h4>ğŸ“ˆ å‡¦ç†ã‚µãƒ³ãƒ—ãƒ«çµæœï¼ˆæœ€åˆã®3ä»¶ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${lightweightData.results.slice(0, 3).map((result, index) => `
                        <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2);">
                            <strong>${index + 1}. ${result.title}</strong><br>
                            <small>ç”Ÿæˆã‚¿ã‚°: ${result.generated_tags.join(', ')}</small>
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="downloadClientSideResults('csv')">ğŸ“¥ çµæœã‚’CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="downloadClientSideResults('json')">ğŸ“¥ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’JSONã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="downloadClientSideResults('tags')">ğŸ“¥ ã‚¿ã‚°ã®ã¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                </div>
            `;
        }
        
        function downloadClientSideResults(format) {
            if (!window.resultsData) {
                alert('çµæœãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const data = window.resultsData;
            let content = '';
            let filename = '';
            let mimeType = '';
            
            if (format === 'csv') {
                // CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆShift-JISå¯¾å¿œï¼‰
                const csvRows = [
                    'ã‚¿ã‚¤ãƒˆãƒ«,ã‚¹ã‚­ãƒ«,ç”Ÿæˆã‚¿ã‚°ï¼ˆ10-15å€‹ï¼‰,ä¿¡é ¼åº¦,å‡¦ç†ã‚¿ã‚¤ãƒ—'
                ];
                
                data.lightweightData.results.forEach(result => {
                    const tags = result.generated_tags.join('; ');
                    csvRows.push(`"${result.title}","${result.skill}","${tags}",${result.confidence},"${result.processing_type}"`);
                });
                
                content = csvRows.join('\r\n'); // Windowsæ”¹è¡Œã‚³ãƒ¼ãƒ‰
                filename = `tag_results_client_side_${new Date().toISOString().slice(0,10)}.csv`;
                
                // UTF-8 BOMä»˜ãã§ã‚¨ã‚¯ã‚»ãƒ«å¯¾å¿œ
                const bom = new Uint8Array([0xEF, 0xBB, 0xBF]); // UTF-8 BOM
                const encoder = new TextEncoder();
                const uint8Array = encoder.encode(content);
                const blob = new Blob([bom, uint8Array], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                URL.revokeObjectURL(link.href);
                return;
                
            } else if (format === 'json') {
                // JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                content = JSON.stringify(data, null, 2);
                filename = `tag_results_client_side_${new Date().toISOString().slice(0,10)}.json`;
                mimeType = 'application/json;charset=utf-8;';
                
            } else if (format === 'tags') {
                // ã‚¿ã‚°ã®ã¿ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼
                const allTags = data.unifiedData.results[0].unified_tags;
                content = allTags.join('\n');
                filename = `unified_tags_client_side_${new Date().toISOString().slice(0,10)}.txt`;
                mimeType = 'text/plain;charset=utf-8;';
            }
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            URL.revokeObjectURL(link.href);
        }
        
        function displayStageResults(sheetsData, lightweightData, detailedData, unifiedData) {
            const aiEngine = document.getElementById('ai-engine').selectedOptions[0].text;
            const maxTags = document.getElementById('max-tags').value;
            const batchSize = document.getElementById('batch-size').value;
            const quality = document.getElementById('quality').selectedOptions[0].text;
            
            // çµæœãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
            window.resultsData = {
                sheetsData: sheetsData,
                lightweightData: lightweightData,
                detailedData: detailedData,
                unifiedData: unifiedData
            };
            
            const unifiedResult = unifiedData.results[0]; // çµ±åˆçµæœã¯é…åˆ—ã®æœ€åˆã®è¦ç´ 
            
            document.getElementById('result-content').innerHTML = `
                <div class="status success">
                    <h3>ğŸ‰ æ®µéšçš„å‡¦ç†å®Œäº†</h3>
                    <p>â€¢ å‡¦ç†å‹•ç”»æ•°: ${sheetsData.total_rows}ä»¶</p>
                    <p>â€¢ è»½é‡å‡¦ç†: ${lightweightData.processed_count}ä»¶ (${lightweightData.processing_time.toFixed(2)}ç§’)</p>
                    <p>â€¢ è©³ç´°å‡¦ç†: ${detailedData.processed_count}ä»¶ (${detailedData.processing_time.toFixed(2)}ç§’)</p>
                    <p>â€¢ çµ±åˆå‡¦ç†: ${unifiedResult.original_count}å€‹ â†’ ${unifiedResult.unified_count}å€‹ã«æœ€é©åŒ–</p>
                    <p>â€¢ ä½¿ç”¨AI: ${aiEngine} (${lightweightData.ai_mode === 'real' ? 'å®ŸAPI' : 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'}ãƒ¢ãƒ¼ãƒ‰)</p>
                    <p>â€¢ å‡¦ç†å“è³ª: ${quality}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: rgba(76,175,80,0.2); padding: 15px; border-radius: 8px;">
                        <h5>ğŸš€ è»½é‡ãƒãƒƒãƒå‡¦ç†</h5>
                        <p>å…¨${lightweightData.processed_count}ä»¶å‡¦ç†</p>
                        <p>å¹³å‡ã‚¿ã‚°æ•°: ${(lightweightData.total_tags_generated / lightweightData.processed_count).toFixed(1)}å€‹/å‹•ç”»</p>
                    </div>
                    <div style="background: rgba(33,150,243,0.2); padding: 15px; border-radius: 8px;">
                        <h5>ğŸ” è©³ç´°å€‹åˆ¥å‡¦ç†</h5>
                        <p>ä¸Šä½${detailedData.processed_count}ä»¶å‡¦ç†</p>
                        <p>å¹³å‡ã‚¿ã‚°æ•°: ${(detailedData.total_tags_generated / detailedData.processed_count).toFixed(1)}å€‹/å‹•ç”»</p>
                    </div>
                    <div style="background: rgba(156,39,176,0.2); padding: 15px; border-radius: 8px;">
                        <h5>ğŸ”§ çµ±åˆæœ€é©åŒ–</h5>
                        <p>é¡ä¼¼ã‚¿ã‚°çµ±åˆ: ${unifiedResult.original_count - unifiedResult.unified_count}å€‹å‰Šæ¸›</p>
                        <p>æœ€çµ‚ã‚¿ã‚°æ•°: ${unifiedResult.unified_count}å€‹</p>
                    </div>
                </div>
                
                <h4>ğŸ† æœ€çµ‚çµ±åˆã‚¿ã‚°ï¼ˆä¸Šä½20å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${unifiedResult.unified_tags.slice(0, 20).join(', ')}
                </div>
                
                <h4>ğŸ“Š ã‚¿ã‚°å‡ºç¾é »åº¦ï¼ˆä¸Šä½10å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${Object.entries(unifiedResult.tag_frequencies).slice(0, 10).map(([tag, freq]) => `
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>${tag}</span>
                            <span>${freq}å› (${((freq / sheetsData.total_rows) * 100).toFixed(1)}%)</span>
                        </div>
                    `).join('')}
                </div>
                
                <h4>ğŸ“ˆ è»½é‡å‡¦ç†ã‚µãƒ³ãƒ—ãƒ«çµæœï¼ˆæœ€åˆã®3ä»¶ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${lightweightData.results.slice(0, 3).map((result, index) => `
                        <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2);">
                            <strong>${index + 1}. ${result.title}</strong><br>
                            <small>è»½é‡ã‚¿ã‚°: ${result.generated_tags.join(', ')}</small>
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="downloadStageResults('csv')">ğŸ“¥ çµ±åˆçµæœã‚’CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="downloadStageResults('json')">ğŸ“¥ å…¨æ®µéšãƒ‡ãƒ¼ã‚¿ã‚’JSONã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="downloadStageResults('tags')">ğŸ“¥ æœ€çµ‚ã‚¿ã‚°ã®ã¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="showStageReport()">ğŸ“ˆ è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</button>
                </div>
            `;
        }
        
        function displayResults(sheetsData, aiData, optimizeData) {
            const aiEngine = document.getElementById('ai-engine').selectedOptions[0].text;
            const maxTags = document.getElementById('max-tags').value;
            const batchSize = document.getElementById('batch-size').value;
            const quality = document.getElementById('quality').selectedOptions[0].text;
            
            // çµæœãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
            window.resultsData = {
                sheetsData: sheetsData,
                aiData: aiData,
                optimizeData: optimizeData
            };
            
            document.getElementById('result-content').innerHTML = `
                <div class="status success">
                    <h3>ğŸ‰ å‡¦ç†å®Œäº†</h3>
                    <p>â€¢ å‡¦ç†å‹•ç”»æ•°: ${sheetsData.total_rows}ä»¶</p>
                    <p>â€¢ ç”Ÿæˆã‚¿ã‚°æ•°: ${optimizeData.original_count}å€‹ â†’ ${optimizeData.optimized_count}å€‹ã«æœ€é©åŒ–</p>
                    <p>â€¢ å‡¦ç†æ™‚é–“: ${aiData.processing_time.toFixed(2)}ç§’</p>
                    <p>â€¢ ä½¿ç”¨AI: ${aiEngine} (${aiData.ai_mode === 'real' ? 'å®ŸAPI' : 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'}ãƒ¢ãƒ¼ãƒ‰)</p>
                    <p>â€¢ ãƒãƒƒãƒã‚µã‚¤ã‚º: ${batchSize}ä»¶</p>
                    <p>â€¢ å‡¦ç†å“è³ª: ${quality}</p>
                    <p>â€¢ å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚°: ${optimizeData.original_count - optimizeData.optimized_count}å€‹</p>
                </div>
                
                <h4>ğŸ“‹ æœ€é©åŒ–ã•ã‚ŒãŸã‚¿ã‚°ï¼ˆä¸Šä½20å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${optimizeData.optimized_tags.slice(0, 20).join(', ')}
                </div>
                
                <h4>ğŸ“Š ã‚¿ã‚°å‡ºç¾é »åº¦ï¼ˆä¸Šä½10å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${Object.entries(optimizeData.tag_frequencies).slice(0, 10).map(([tag, freq]) => 
                        `${tag}: ${freq}å›`).join('<br>')}
                </div>
                
                <h4>ğŸ“ˆ å‹•ç”»åˆ¥ã‚¿ã‚°ç”Ÿæˆçµæœï¼ˆæœ€åˆã®5ä»¶ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${aiData.results.slice(0, 5).map((result, index) => `
                        <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2);">
                            <strong>${index + 1}. ${result.title}</strong><br>
                            <small>ã‚¿ã‚°: ${result.generated_tags.join(', ')}</small>
                        </div>
                    `).join('')}
                    ${aiData.results.length > 5 ? `<p style="opacity: 0.7;">...ä»–${aiData.results.length - 5}ä»¶</p>` : ''}
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="downloadResults('csv')">ğŸ“¥ çµæœã‚’CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="downloadResults('json')">ğŸ“¥ çµæœã‚’JSONã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="downloadTagsOnly()">ğŸ“¥ ã‚¿ã‚°ã®ã¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn btn-secondary" onclick="showDetailedReport()">ğŸ“ˆ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</button>
                </div>
            `;
        }
        
        function downloadResults(format) {
            if (!window.resultsData) {
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const { aiData, optimizeData } = window.resultsData;
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
            
            if (format === 'csv') {
                // CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                let csv = 'ã‚¿ã‚¤ãƒˆãƒ«,ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚°,ã‚¿ã‚°æ•°,ä¿¡é ¼åº¦\n';
                aiData.results.forEach(result => {
                    csv += `"${result.title}","${result.generated_tags.join(', ')}",${result.generated_tags.length},${result.confidence.toFixed(2)}\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `tag_results_${timestamp}.csv`;
                link.click();
                
            } else if (format === 'json') {
                // JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const jsonData = {
                    metadata: {
                        generated_at: new Date().toISOString(),
                        total_videos: aiData.results.length,
                        total_tags: optimizeData.optimized_count,
                        ai_engine: aiData.ai_engine,
                        ai_mode: aiData.ai_mode,
                        processing_time: aiData.processing_time
                    },
                    results: aiData.results,
                    optimized_tags: optimizeData.optimized_tags,
                    tag_frequencies: optimizeData.tag_frequencies
                };
                
                const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `tag_results_${timestamp}.json`;
                link.click();
            }
        }
        
        function downloadTagsOnly() {
            if (!window.resultsData) {
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const { optimizeData } = window.resultsData;
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
            
            // ã‚¿ã‚°ã®ã¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const tagsText = optimizeData.optimized_tags.join('\n');
            const blob = new Blob([tagsText], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `optimized_tags_${timestamp}.txt`;
            link.click();
        }
        
        function downloadStageResults(format) {
            if (!window.resultsData) {
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const { lightweightData, detailedData, unifiedData } = window.resultsData;
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
            const unifiedResult = unifiedData.results[0];
            
            if (format === 'csv') {
                // çµ±åˆçµæœã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                let csv = 'ã‚¿ã‚°,å‡ºç¾é »åº¦,å‡¦ç†æ®µéš\n';
                Object.entries(unifiedResult.tag_frequencies).forEach(([tag, freq]) => {
                    const sources = unifiedResult.tag_sources[tag];
                    const sourceInfo = [];
                    if (sources?.lightweight) sourceInfo.push(`è»½é‡:${sources.lightweight}`);
                    if (sources?.detailed) sourceInfo.push(`è©³ç´°:${sources.detailed}`);
                    csv += `"${tag}",${freq},"${sourceInfo.join(', ')}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `stage_results_${timestamp}.csv`;
                link.click();
                
            } else if (format === 'json') {
                // å…¨æ®µéšãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const jsonData = {
                    metadata: {
                        generated_at: new Date().toISOString(),
                        processing_method: 'staged_processing',
                        total_videos: lightweightData.processed_count,
                        detailed_videos: detailedData.processed_count,
                        final_tags: unifiedResult.unified_count
                    },
                    lightweight_processing: {
                        results: lightweightData.results,
                        processing_time: lightweightData.processing_time,
                        ai_mode: lightweightData.ai_mode
                    },
                    detailed_processing: {
                        results: detailedData.results,
                        processing_time: detailedData.processing_time,
                        ai_mode: detailedData.ai_mode
                    },
                    unified_results: unifiedResult
                };
                
                const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `stage_results_complete_${timestamp}.json`;
                link.click();
                
            } else if (format === 'tags') {
                // æœ€çµ‚ã‚¿ã‚°ã®ã¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const tagsText = unifiedResult.unified_tags.join('\n');
                const blob = new Blob([tagsText], { type: 'text/plain;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `final_unified_tags_${timestamp}.txt`;
                link.click();
            }
        }
        
        function showStageReport() {
            if (!window.resultsData) {
                alert('è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const { lightweightData, detailedData, unifiedData } = window.resultsData;
            const unifiedResult = unifiedData.results[0];
            
            // æ®µéšçš„å‡¦ç†ã®è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§è¡¨ç¤º
            const reportWindow = window.open('', 'StageReport', 'width=1000,height=700');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>æ®µéšçš„å‡¦ç† - è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
                        h1 { color: #333; text-align: center; }
                        .section { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
                        .stage { padding: 15px; border-radius: 8px; text-align: center; }
                        .stage1 { background: rgba(76,175,80,0.1); border: 2px solid #4CAF50; }
                        .stage2 { background: rgba(33,150,243,0.1); border: 2px solid #2196F3; }
                        .stage3 { background: rgba(156,39,176,0.1); border: 2px solid #9C27B0; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #f2f2f2; }
                        .metric { display: flex; justify-content: space-between; margin: 5px 0; }
                    </style>
                </head>
                <body>
                    <h1>ğŸ¯ æ®µéšçš„å‡¦ç† - è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h1>
                    
                    <div class="section">
                        <h2>ğŸ“Š å‡¦ç†æ¦‚è¦</h2>
                        <p><strong>ç”Ÿæˆæ—¥æ™‚:</strong> ${new Date().toLocaleString('ja-JP')}</p>
                        <p><strong>å‡¦ç†æ–¹å¼:</strong> æ®µéšçš„å‡¦ç†ï¼ˆè»½é‡â†’è©³ç´°â†’çµ±åˆï¼‰</p>
                        <p><strong>ç·å‡¦ç†æ™‚é–“:</strong> ${(lightweightData.processing_time + detailedData.processing_time + unifiedData.processing_time).toFixed(2)}ç§’</p>
                    </div>
                    
                    <div class="grid">
                        <div class="stage stage1">
                            <h3>ğŸš€ è»½é‡ãƒãƒƒãƒå‡¦ç†</h3>
                            <div class="metric"><span>å‡¦ç†ä»¶æ•°:</span><span>${lightweightData.processed_count}ä»¶</span></div>
                            <div class="metric"><span>å‡¦ç†æ™‚é–“:</span><span>${lightweightData.processing_time.toFixed(2)}ç§’</span></div>
                            <div class="metric"><span>ç”Ÿæˆã‚¿ã‚°:</span><span>${lightweightData.total_tags_generated}å€‹</span></div>
                            <div class="metric"><span>å¹³å‡ã‚¿ã‚°/å‹•ç”»:</span><span>${(lightweightData.total_tags_generated / lightweightData.processed_count).toFixed(1)}å€‹</span></div>
                        </div>
                        <div class="stage stage2">
                            <h3>ğŸ” è©³ç´°å€‹åˆ¥å‡¦ç†</h3>
                            <div class="metric"><span>å‡¦ç†ä»¶æ•°:</span><span>${detailedData.processed_count}ä»¶</span></div>
                            <div class="metric"><span>å‡¦ç†æ™‚é–“:</span><span>${detailedData.processing_time.toFixed(2)}ç§’</span></div>
                            <div class="metric"><span>ç”Ÿæˆã‚¿ã‚°:</span><span>${detailedData.total_tags_generated}å€‹</span></div>
                            <div class="metric"><span>å¹³å‡ã‚¿ã‚°/å‹•ç”»:</span><span>${(detailedData.total_tags_generated / detailedData.processed_count).toFixed(1)}å€‹</span></div>
                        </div>
                        <div class="stage stage3">
                            <h3>ğŸ”§ çµ±åˆæœ€é©åŒ–</h3>
                            <div class="metric"><span>çµ±åˆå‰ã‚¿ã‚°:</span><span>${unifiedResult.original_count}å€‹</span></div>
                            <div class="metric"><span>çµ±åˆå¾Œã‚¿ã‚°:</span><span>${unifiedResult.unified_count}å€‹</span></div>
                            <div class="metric"><span>å‰Šæ¸›æ•°:</span><span>${unifiedResult.original_count - unifiedResult.unified_count}å€‹</span></div>
                            <div class="metric"><span>å‰Šæ¸›ç‡:</span><span>${((unifiedResult.original_count - unifiedResult.unified_count) / unifiedResult.original_count * 100).toFixed(1)}%</span></div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2>ğŸ† æœ€çµ‚çµ±åˆã‚¿ã‚°é »åº¦åˆ†æ</h2>
                        <table>
                            <tr><th>ã‚¿ã‚°</th><th>ç·å‡ºç¾å›æ•°</th><th>è»½é‡å‡¦ç†</th><th>è©³ç´°å‡¦ç†</th><th>å‡ºç¾ç‡</th></tr>
                            ${Object.entries(unifiedResult.tag_frequencies).slice(0, 20).map(([tag, freq]) => {
                                const sources = unifiedResult.tag_sources[tag] || {};
                                const totalVideos = lightweightData.processed_count;
                                return `
                                    <tr>
                                        <td>${tag}</td>
                                        <td>${freq}</td>
                                        <td>${sources.lightweight || 0}</td>
                                        <td>${sources.detailed || 0}</td>
                                        <td>${(freq / totalVideos * 100).toFixed(1)}%</td>
                                    </tr>
                                `;
                            }).join('')}
                        </table>
                    </div>
                </body>
                </html>
            `);
        }
        
        function showDetailedReport() {
            if (!window.resultsData) {
                alert('è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const { aiData, optimizeData } = window.resultsData;
            
            // è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§è¡¨ç¤º
            const reportWindow = window.open('', 'DetailedReport', 'width=800,height=600');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Tag Generator - è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
                        h1 { color: #333; }
                        .section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>Tag Generator è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ</h1>
                    <div class="section">
                        <h2>å‡¦ç†æ¦‚è¦</h2>
                        <p>ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}</p>
                        <p>å‡¦ç†å‹•ç”»æ•°: ${aiData.results.length}ä»¶</p>
                        <p>ç”Ÿæˆã‚¿ã‚°ç·æ•°: ${optimizeData.original_count}å€‹</p>
                        <p>æœ€é©åŒ–å¾Œã‚¿ã‚°æ•°: ${optimizeData.optimized_count}å€‹</p>
                        <p>å‡¦ç†æ™‚é–“: ${aiData.processing_time.toFixed(2)}ç§’</p>
                        <p>AIã‚¨ãƒ³ã‚¸ãƒ³: ${aiData.ai_engine} (${aiData.ai_mode}ãƒ¢ãƒ¼ãƒ‰)</p>
                    </div>
                    <div class="section">
                        <h2>ã‚¿ã‚°é »åº¦åˆ†æ</h2>
                        <table>
                            <tr><th>ã‚¿ã‚°</th><th>å‡ºç¾å›æ•°</th><th>å‰²åˆ</th></tr>
                            ${Object.entries(optimizeData.tag_frequencies).map(([tag, freq]) => `
                                <tr>
                                    <td>${tag}</td>
                                    <td>${freq}</td>
                                    <td>${(freq / aiData.results.length * 100).toFixed(1)}%</td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                </body>
                </html>
            `);
        }
        
        async function previewData() {
            const statusDiv = document.getElementById('connection-status');
            const url = document.getElementById('sheets-url').value;
            
            if (!url) {
                statusDiv.innerHTML = '<div class="status warning">URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            statusDiv.innerHTML = '<div class="status info">ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
            
            try {
                const response = await callAPI('sheets_data', {
                    method: 'POST',
                    body: JSON.stringify({
                        url: url,
                        preview: true
                    })
                });
                
                const data = response;
                
                if (data.success) {
                    const sampleData = data.data.slice(0, 3);
                    statusDiv.innerHTML = `
                        <div class="status info">
                            <h4>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                            ${sampleData.map(item => `
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                                    <strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${item.title}<br>
                                    <strong>ã‚¹ã‚­ãƒ«:</strong> ${item.skill}<br>
                                    <strong>èª¬æ˜:</strong> ${item.description}
                                </div>
                            `).join('')}
                            <p><strong>ç·ãƒ‡ãƒ¼ã‚¿æ•°:</strong> ${data.total_rows}ä»¶</p>
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = async function() {
            console.log('Tag Generator APIç‰ˆãŒèµ·å‹•ã—ã¾ã—ãŸ');
            console.log('API Base URL:', API_BASE_URL);
            await checkApiStatus();
        };
    </script>
</body>
</html>