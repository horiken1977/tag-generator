<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ·ï¸ Tag Generator - APIç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .form-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
        }
        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .btn:hover { background: #45a049; }
        .btn:disabled { background: #666; cursor: not-allowed; }
        .btn-secondary { background: #2196F3; }
        .btn-secondary:hover { background: #1976D2; }
        .btn-home { background: #FF9800; }
        .btn-home:hover { background: #F57C00; }
        .progress {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .status.success { background: rgba(76,175,80,0.3); }
        .status.info { background: rgba(33,150,243,0.3); }
        .status.warning { background: rgba(255,193,7,0.3); }
        .status.error { background: rgba(244,67,54,0.3); }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .hidden { display: none; }
        .result-section {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .api-mode {
            background: rgba(76,175,80,0.2);
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .column-mapping {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .column-mapping h4 {
            margin-bottom: 10px;
            color: #74c0fc;
        }
        .mapping-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ·ï¸ Tag Generator</h1>
            <p>ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ•™è‚²å‹•ç”»ã®AIã‚¿ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  - APIç‰ˆ</p>
            <button class="btn btn-home" onclick="window.location.href='index.html'">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        </div>
        
        <div class="api-mode">
            <h3>ğŸ”— APIé€£æºãƒ¢ãƒ¼ãƒ‰</h3>
            <p>å®Ÿéš›ã®Google Sheets APIã¨AIå‡¦ç†æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™</p>
            <div id="api-status">ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³ã‚’ç¢ºèªä¸­...</div>
        </div>
        
        <div class="card">
            <h2>ğŸ“Š Google Sheets è¨­å®š</h2>
            <div class="form-group">
                <label for="sheets-url">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL</label>
                <input type="url" id="sheets-url" placeholder="https://docs.google.com/spreadsheets/d/...">
                <small style="opacity: 0.8;">â€»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯å…¬é–‹è¨­å®šã«ã—ã¦ãã ã•ã„</small>
            </div>
            <button class="btn btn-secondary" onclick="testConnection()" id="test-btn">
                <span id="test-loading" class="loading hidden"></span>
                æ¥ç¶šãƒ†ã‚¹ãƒˆ
            </button>
            
            <div id="connection-status"></div>
            
            <div id="column-mapping" class="column-mapping hidden">
                <h4>ğŸ“‹ åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š</h4>
                <p style="opacity: 0.8; margin-bottom: 15px;">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’ä¸‹è¨˜ã®é …ç›®ã«å‰²ã‚Šå½“ã¦ã¦ãã ã•ã„ã€‚å¿…é ˆé …ç›®ï¼šã‚¿ã‚¤ãƒˆãƒ«ã€ã‚¹ã‚­ãƒ«å</p>
                <div class="mapping-row">
                    <label><span style="color: #ff6b6b;">*</span> ã‚¿ã‚¤ãƒˆãƒ«åˆ—:</label>
                    <select id="title-column" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label><span style="color: #ff6b6b;">*</span> ã‚¹ã‚­ãƒ«ååˆ—:</label>
                    <select id="skill-column" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label>èª¬æ˜æ–‡åˆ—:</label>
                    <select id="description-column">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label>è¦ç´„åˆ—:</label>
                    <select id="summary-column">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</option>
                    </select>
                </div>
                <div class="mapping-row">
                    <label>æ–‡å­—èµ·ã“ã—åˆ—:</label>
                    <select id="transcript-column">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</option>
                    </select>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(74, 144, 226, 0.2); border-radius: 5px;">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®1è¡Œç›®ãŒãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯2è¡Œç›®ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
                </div>
            </div>
        </div>
        
        <div class="grid">
            <div class="card">
                <h2>ğŸ¤– AI ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ</h2>
                <div class="form-group">
                    <label for="ai-engine">å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³</label>
                    <select id="ai-engine">
                        <option value="openai">OpenAI GPT-4</option>
                        <option value="claude">Claude 3.5 Sonnet</option>
                        <option value="gemini">Google Gemini</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="max-tags">æœ€å¤§ã‚¿ã‚°æ•°</label>
                    <select id="max-tags">
                        <option value="150">150å€‹</option>
                        <option value="200" selected>200å€‹ (æ¨å¥¨)</option>
                        <option value="250">250å€‹</option>
                    </select>
                </div>
            </div>
            
            <div class="card">
                <h2>âš™ï¸ å‡¦ç†è¨­å®š</h2>
                <div class="form-group">
                    <label for="batch-size">ãƒãƒƒãƒã‚µã‚¤ã‚º</label>
                    <select id="batch-size">
                        <option value="10">10ä»¶</option>
                        <option value="20" selected>20ä»¶ (æ¨å¥¨)</option>
                        <option value="50">50ä»¶</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quality">å‡¦ç†å“è³ª</label>
                    <select id="quality">
                        <option value="fast">é«˜é€Ÿå‡¦ç†</option>
                        <option value="balanced" selected>ãƒãƒ©ãƒ³ã‚¹</option>
                        <option value="high">é«˜å“è³ª</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸš€ å‡¦ç†å®Ÿè¡Œ</h2>
            <button class="btn" onclick="startProcessing()" id="process-btn" disabled>
                <span id="process-loading" class="loading hidden"></span>
                ã‚¿ã‚°ç”Ÿæˆé–‹å§‹
            </button>
            <button class="btn btn-secondary" onclick="previewData()">ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
            
            <div id="processing-status" class="hidden">
                <div class="progress">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div id="status-text">å‡¦ç†ä¸­...</div>
            </div>
        </div>
        
        <div class="card result-section hidden" id="results">
            <h2>ğŸ“‹ å‡¦ç†çµæœ</h2>
            <div id="result-content"></div>
        </div>
    </div>
    
    <script>
        let isProcessing = false;
        let sheetData = null;
        let columnHeaders = [];
        
        // APIãƒ™ãƒ¼ã‚¹URLã®è¨­å®šï¼ˆPHP APIä½¿ç”¨ï¼‰
        const API_BASE_URL = window.location.protocol + '//' + window.location.hostname + window.location.pathname.replace(/\/[^\/]*$/, '') + '/api.php';
        
        // APIå‘¼ã³å‡ºã—ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        async function callAPI(action, options = {}) {
            try {
                const url = API_BASE_URL + '?action=' + action;
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call error:', error);
                throw error;
            }
        }
        
        // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³ç¢ºèª
        async function checkApiStatus() {
            try {
                const data = await callAPI('status');
                
                if (data.status === 'running') {
                    document.getElementById('api-status').innerHTML = 
                        `âœ… APIã‚µãƒ¼ãƒãƒ¼ç¨¼åƒä¸­ (v${data.version})`;
                    return true;
                }
            } catch (error) {
                document.getElementById('api-status').innerHTML = 
                    `âŒ APIã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ (${error.message})`;
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
                console.error('API Status Check Failed:', error);
                console.log('Attempted URL:', API_BASE_URL + '?action=status');
                
                return false;
            }
        }
        
        async function testConnection() {
            const url = document.getElementById('sheets-url').value;
            const statusDiv = document.getElementById('connection-status');
            const testBtn = document.getElementById('test-btn');
            const loading = document.getElementById('test-loading');
            
            if (!url) {
                statusDiv.innerHTML = '<div class="status warning">URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            // Show loading
            testBtn.disabled = true;
            loading.classList.remove('hidden');
            statusDiv.innerHTML = '<div class="status info">æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                const data = await callAPI('sheets_test', {
                    method: 'POST',
                    body: JSON.stringify({url: url})
                });
                
                if (data.success) {
                    columnHeaders = data.columns || [];
                    
                    statusDiv.innerHTML = `
                        <div class="status success">
                            âœ… æ¥ç¶šæˆåŠŸ<br>
                            ã‚·ãƒ¼ãƒˆID: ${data.sheet_id}<br>
                            ãƒ‡ãƒ¼ã‚¿è¡Œæ•°: ${data.rows}è¡Œ<br>
                            åˆ—: ${data.columns.join(', ')}<br>
                        </div>
                    `;
                    
                    // åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šã‚’è¡¨ç¤º
                    if (columnHeaders.length > 0) {
                        setupColumnMapping(columnHeaders);
                        document.getElementById('process-btn').disabled = false;
                    }
                } else {
                    statusDiv.innerHTML = `<div class="status error">âŒ ${data.error}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            } finally {
                testBtn.disabled = false;
                loading.classList.add('hidden');
            }
        }
        
        function setupColumnMapping(columns) {
            const mappingDiv = document.getElementById('column-mapping');
            mappingDiv.classList.remove('hidden');
            
            // å„ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«åˆ—åã‚’è¨­å®š
            const selects = [
                {id: 'title-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„', keywords: ['ã‚¿ã‚¤ãƒˆãƒ«', 'title', 'é¡Œå', 'ãƒ†ãƒ¼ãƒ']},
                {id: 'skill-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„', keywords: ['ã‚¹ã‚­ãƒ«', 'skill', 'ã‚«ãƒ†ã‚´ãƒª', 'category']},
                {id: 'description-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰', keywords: ['èª¬æ˜', 'description', 'æ¦‚è¦', 'summary']},
                {id: 'summary-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰', keywords: ['è¦ç´„', 'summary', 'ã¾ã¨ã‚', 'æ¦‚è¦']},
                {id: 'transcript-column', placeholder: 'é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰', keywords: ['æ–‡å­—èµ·ã“ã—', 'transcript', 'å†…å®¹', 'content', 'æœ¬æ–‡']}
            ];
            
            selects.forEach(selectConfig => {
                const select = document.getElementById(selectConfig.id);
                select.innerHTML = `<option value="">${selectConfig.placeholder}</option>`;
                
                // å¤‰æ›´æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
                select.addEventListener('change', updateValidationStatus);
                
                columns.forEach((col, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${col} (åˆ—${String.fromCharCode(65 + index)})`;
                    
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã®æ¨æ¸¬ï¼ˆã‚ˆã‚Šè©³ç´°ã«ï¼‰
                    const colLower = col.toLowerCase();
                    const isMatch = selectConfig.keywords.some(keyword => 
                        colLower.includes(keyword.toLowerCase()) || 
                        col.includes(keyword)
                    );
                    
                    if (isMatch && !select.value) {
                        option.selected = true;
                    }
                    
                    select.appendChild(option);
                });
            });
            
            // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
            updateValidationStatus();
        }
        
        function updateValidationStatus() {
            const titleSelected = document.getElementById('title-column').value;
            const skillSelected = document.getElementById('skill-column').value;
            const processBtn = document.getElementById('process-btn');
            
            if (titleSelected && skillSelected) {
                processBtn.disabled = false;
                processBtn.textContent = 'ã‚¿ã‚°ç”Ÿæˆé–‹å§‹';
            } else {
                processBtn.disabled = true;
                processBtn.textContent = 'å¿…é ˆé …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„';
            }
        }
        
        
        async function startProcessing() {
            if (isProcessing) return;
            
            const url = document.getElementById('sheets-url').value;
            if (!url) {
                alert('Google Sheetsã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºèª
            const columnMapping = {
                title: document.getElementById('title-column').value,
                skill: document.getElementById('skill-column').value,
                description: document.getElementById('description-column').value,
                summary: document.getElementById('summary-column').value,
                transcript: document.getElementById('transcript-column').value
            };
            
            if (!columnMapping.title || !columnMapping.skill) {
                alert('å°‘ãªãã¨ã‚‚ã‚¿ã‚¤ãƒˆãƒ«åˆ—ã¨ã‚¹ã‚­ãƒ«åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            isProcessing = true;
            const statusDiv = document.getElementById('processing-status');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');
            const resultsDiv = document.getElementById('results');
            const processBtn = document.getElementById('process-btn');
            const loading = document.getElementById('process-loading');
            
            processBtn.disabled = true;
            loading.classList.remove('hidden');
            statusDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            
            try {
                // Step 1: Get data from sheets
                statusText.textContent = 'Google Sheetsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...';
                progressBar.style.width = '20%';
                
                const sheetsResponse = await callAPI('sheets_data', {
                    method: 'POST',
                    body: JSON.stringify({
                        url: url,
                        column_mapping: columnMapping
                    })
                });
                
                const sheetsData = sheetsResponse;
                
                // Step 2: Process with AI
                statusText.textContent = 'AIå‡¦ç†ä¸­...';
                progressBar.style.width = '60%';
                
                const aiResponse = await callAPI('ai_process', {
                    method: 'POST',
                    body: JSON.stringify({
                        data: sheetsData.data,
                        ai_engine: document.getElementById('ai-engine').value,
                        batch_size: document.getElementById('batch-size').value,
                        quality: document.getElementById('quality').value,
                        use_real_ai: true  // å®Ÿéš›ã®AI APIã‚’ä½¿ç”¨
                    })
                });
                
                const aiData = aiResponse;
                
                // Step 3: Optimize tags
                statusText.textContent = 'ã‚¿ã‚°æœ€é©åŒ–ä¸­...';
                progressBar.style.width = '90%';
                
                const allTags = aiData.results.map(item => item.generated_tags);
                const optimizeResponse = await callAPI('tags_optimize', {
                    method: 'POST',
                    body: JSON.stringify({
                        tags: allTags,
                        max_tags: parseInt(document.getElementById('max-tags').value)
                    })
                });
                
                const optimizeData = optimizeResponse;
                
                // Complete
                statusText.textContent = 'å®Œäº†!';
                progressBar.style.width = '100%';
                
                // Show results
                setTimeout(() => {
                    displayResults(sheetsData, aiData, optimizeData);
                    statusDiv.classList.add('hidden');
                    resultsDiv.classList.remove('hidden');
                }, 1000);
                
            } catch (error) {
                statusText.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 3000);
            } finally {
                isProcessing = false;
                processBtn.disabled = false;
                loading.classList.add('hidden');
            }
        }
        
        function displayResults(sheetsData, aiData, optimizeData) {
            const aiEngine = document.getElementById('ai-engine').selectedOptions[0].text;
            const maxTags = document.getElementById('max-tags').value;
            const batchSize = document.getElementById('batch-size').value;
            const quality = document.getElementById('quality').selectedOptions[0].text;
            
            document.getElementById('result-content').innerHTML = `
                <div class="status success">
                    <h3>ğŸ‰ å‡¦ç†å®Œäº†</h3>
                    <p>â€¢ å‡¦ç†å‹•ç”»æ•°: ${sheetsData.total_rows}ä»¶</p>
                    <p>â€¢ ç”Ÿæˆã‚¿ã‚°æ•°: ${optimizeData.original_count}å€‹ â†’ ${optimizeData.optimized_count}å€‹ã«æœ€é©åŒ–</p>
                    <p>â€¢ å‡¦ç†æ™‚é–“: ${aiData.processing_time}ç§’</p>
                    <p>â€¢ ä½¿ç”¨AI: ${aiEngine} (${aiData.ai_mode}ãƒ¢ãƒ¼ãƒ‰)</p>
                    <p>â€¢ ãƒãƒƒãƒã‚µã‚¤ã‚º: ${batchSize}ä»¶</p>
                    <p>â€¢ å‡¦ç†å“è³ª: ${quality}</p>
                    <p>â€¢ å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚°: ${optimizeData.original_count - optimizeData.optimized_count}å€‹</p>
                </div>
                <h4>ğŸ“‹ æœ€é©åŒ–ã•ã‚ŒãŸã‚¿ã‚°ï¼ˆä¸Šä½20å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${optimizeData.optimized_tags.slice(0, 20).join(', ')}
                </div>
                <h4>ğŸ“Š ã‚¿ã‚°å‡ºç¾é »åº¦ï¼ˆä¸Šä½10å€‹ï¼‰</h4>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    ${Object.entries(optimizeData.tag_frequencies).slice(0, 10).map(([tag, freq]) => 
                        `${tag}: ${freq}å›`).join('<br>')}
                </div>
                <button class="btn">ğŸ“¥ çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button class="btn btn-secondary">ğŸ“Š æ–°ã—ã„ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ</button>
                <button class="btn btn-secondary">ğŸ“ˆ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</button>
            `;
        }
        
        async function previewData() {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.innerHTML = '<div class="status info">ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
            
            try {
                const response = await callAPI('sheets_data', {
                    method: 'POST',
                    body: JSON.stringify({preview: true})
                });
                
                const data = response;
                
                if (data.success) {
                    const sampleData = data.data.slice(0, 3);
                    statusDiv.innerHTML = `
                        <div class="status info">
                            <h4>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                            ${sampleData.map(item => `
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                                    <strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${item.title}<br>
                                    <strong>ã‚¹ã‚­ãƒ«:</strong> ${item.skill}<br>
                                    <strong>èª¬æ˜:</strong> ${item.description}
                                </div>
                            `).join('')}
                            <p><strong>ç·ãƒ‡ãƒ¼ã‚¿æ•°:</strong> ${data.total_rows}ä»¶</p>
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = async function() {
            console.log('Tag Generator APIç‰ˆãŒèµ·å‹•ã—ã¾ã—ãŸ');
            console.log('API Base URL:', API_BASE_URL);
            await checkApiStatus();
        };
    </script>
</body>
</html>